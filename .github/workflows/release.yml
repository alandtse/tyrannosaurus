on:
    push:
        tags:
            - v*
jobs:
    deploy:
        runs-on: ubuntu-latest
        steps:
            -
                name: Checkout
                uses: actions/checkout@v2
            -
                name: Set up Python
                uses: actions/setup-python@v2
                with:
                    python-version: '3.8'
            -
                name: Install build dependencies
                run: |
                    python -m pip install --upgrade pip
                    pip install poetry tox tox-gh-actions
            -
                name: Test with tox
                run: |
                    tox
            -
                name: Create release
                id: create_release
                uses: actions/create-release@v1
                env:
                    GITHUB_TOKEN: '${{ secrets.GITHUB_TOKEN }}'
                with:
                    tag_name: '${{ github.ref }}'
                    release_name: '${{ github.ref }}'
                    draft: false
                    prerelease: true
            -
                name: Repository Dispatch
                uses: peter-evans/repository-dispatch@v1
                with:
                    token: '${{ secrets.GITHUB_TOKEN }}'
                event-type: release-made
